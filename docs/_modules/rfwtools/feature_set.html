

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>rfwtools.feature_set &mdash; rfwtools 1.0.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href="../../_static/rtd_custom.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> rfwtools
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/rfwtools.html">rfwtools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rfwtools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>rfwtools.feature_set</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for rfwtools.feature_set</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;The module encapsulates the functionality around computed features of an example set.</span>

<span class="sd">Typically a FeatureSet is created by DataSet.produce_feature_set().  Once created the class provides some tools for</span>
<span class="sd">easy dimensionality reduction and visualization.</span>

<span class="sd">Basic Usage Examples:</span>

<span class="sd">Creation through a DataSet workflow:</span>
<span class="sd">::</span>

<span class="sd">    from rfwtools.data_set import DataSet</span>
<span class="sd">    from rfwtools.extractor.autoregressive import autoregressive_extractor</span>

<span class="sd">    ds = DataSet(label_files=[&#39;my-sample-labels.txt&#39;])</span>
<span class="sd">    ds.produce_example_set()</span>
<span class="sd">    ds.produce_feature_set(autoregressive_extractor)</span>

<span class="sd">    fs = ds.feature_set</span>
<span class="sd">    fs.do_pca_reduction(n_components=10)</span>
<span class="sd">    fs.display_2d_scatterplot(query=&quot;zone==&#39;1L25&#39;&quot;, title=&quot;1L25 PCA subset&quot;)</span>
<span class="sd">    fs.save_csv(&quot;my_feature_set.csv&quot;)</span>

<span class="sd">Loading from file:</span>
<span class="sd">::</span>

<span class="sd">    from rfwtools.feature_set import FeatureSet</span>

<span class="sd">    fs = FeatureSet()</span>
<span class="sd">    fs.load_csv(&quot;my_feature_set.csv&quot;)</span>
<span class="sd">    fs.do_pca_reduction()</span>
<span class="sd">    fs.display_2d_scatterplot(query=&quot;zone==&#39;1L25&#39;&quot;, title=&quot;1L25 PCA subset&quot;)</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">rfwtools.dim_reduction</span> <span class="kn">import</span> <span class="n">pca</span>
<span class="kn">from</span> <span class="nn">rfwtools.visualize</span> <span class="kn">import</span> <span class="n">scatterplot</span>
<span class="kn">from</span> <span class="nn">rfwtools.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">rfwtools.example_set</span> <span class="kn">import</span> <span class="n">ExampleSet</span>


<div class="viewcode-block" id="FeatureSet"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet">[docs]</a><span class="k">class</span> <span class="nc">FeatureSet</span><span class="p">(</span><span class="n">ExampleSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class for managing common operations on a collection of labeled faults and associated features</span>

<span class="sd">    This class is an extension on ExampleSet meant to handle additional analysis operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FeatureSet.__init__"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">in_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">metadata_columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a FeatureSet.  Can use either a DataFrame or CSV-like file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df:</span>
<span class="sd">                A DataFrame containing the FeatureSet data to include.  The following columns must be included -</span>
<span class="sd">                [&#39;zone&#39;, &#39;dtime&#39;, &#39;cavity_label&#39;, &#39;fault_label&#39;, &#39;label_source&#39;].  Any additional columns will be</span>
<span class="sd">                treated as the features.  Note: A copy of df is saved.</span>
<span class="sd">            filename:</span>
<span class="sd">                The filename to load.  Will be relative to in_dir</span>
<span class="sd">            in_dir:</span>
<span class="sd">                The directory to find the CSV-like file in.  Defaults to Config().output_dir</span>
<span class="sd">            sep:</span>
<span class="sd">                Delimiter string used by Pandas to parse given CSV-like file</span>
<span class="sd">            name:</span>
<span class="sd">                A string that may be used to help identify this FeatureSet</span>
<span class="sd">            metadata_columns:</span>
<span class="sd">                A list of the names of the columns that are metadata (e.g., &quot;zone&quot; or &quot;cavity_label&quot;).  Any supplied</span>
<span class="sd">                column names are in addition to the mandatory columns for an ExampleSet.  metadata_columns are treated</span>
<span class="sd">                as required columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Setup the Example</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1">#: These columns are required in internal DataFrames and are excluded from analysis routines.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_metadata_columns</span><span class="p">(</span><span class="n">metadata_columns</span><span class="o">=</span><span class="n">metadata_columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Make sure the DataFrame has the metadata columns.  The</span>
            <span class="k">if</span> <span class="s1">&#39;example&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_example</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A column is missing from the supplied DataFrame or has wrong dtype&quot;</span><span class="p">)</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Example_from_row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A column is missing from the supplied DataFrame or has wrong dtype&quot;</span><span class="p">)</span>

            <span class="c1"># Make a standard column order.  All metadata columns first, followed by feature columns</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>

            <span class="c1"># Import the DataFrame into the ExampleSet&#39;s internal DataFrame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_example_set</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_csv</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">in_dir</span><span class="o">=</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>

        <span class="c1"># A brief human friendly name for this FeatureSet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1">#: The pca reduced feature data, one example per row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: The pca model.  Either None or is the fitted sklearn PCA object.  This is left publicly accessible so users</span>
        <span class="c1">#: have access for custom analysis or visualization (e.g., transforming future examples).  Users beware</span>
        <span class="c1">#: modifying this!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FeatureSet.load_csv"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet.load_csv">[docs]</a>    <span class="k">def</span> <span class="nf">load_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">in_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">metadata_columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read in a CSV file that has FeatureSet data.  Relative to in_dir if filename is str.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            filename:</span>
<span class="sd">                The filename to load.  Will be relative in_dir</span>
<span class="sd">            in_dir:</span>
<span class="sd">                The directory to find the file in.  Defaults to Config().output_dir</span>
<span class="sd">            sep:</span>
<span class="sd">                Delimiter string used by Pandas to parse given &quot;csv&quot; file</span>
<span class="sd">            metadata_columns:</span>
<span class="sd">                A list of column names to treat as metadata.  This updates the FeatureSet&#39;s list.  No changes are made</span>
<span class="sd">                if it is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Update the column info if indicated</span>
        <span class="k">if</span> <span class="n">metadata_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_metadata_columns</span><span class="p">(</span><span class="n">metadata_columns</span><span class="o">=</span><span class="n">metadata_columns</span><span class="p">)</span>

        <span class="c1"># Clear the dimensionality reduction attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Load it into the parent&#39;s ExampleSet _example_df</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_csv</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">in_dir</span><span class="o">=</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureSet.update_metadata_columns"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet.update_metadata_columns">[docs]</a>    <span class="k">def</span> <span class="nf">update_metadata_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This updates the metadata columns and alters other related data structures.</span>

<span class="sd">        self.metadata_columns always include ExampleSet._mandatory_columns.  Does deduplication should you include those</span>
<span class="sd">        as well.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            metadata_columns: A list of metadata columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metadata_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use the required columns of the parent ExampleSet.  Since no extra required columns we can leave</span>
            <span class="c1"># self._req_columns alone</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_required_columns</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Here we&#39;re assuming that all of the metadata columns should be required</span>
            <span class="c1"># This would have the old metadata columns in it, and it is returned by get_required_columns().</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_req_columns</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Make sure we don&#39;t have duplicate column names</span>
            <span class="n">m_uniq</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_required_columns</span><span class="p">()</span> <span class="o">+</span> <span class="n">metadata_columns</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m_uniq</span><span class="p">:</span>
                    <span class="n">m_uniq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span> <span class="o">=</span> <span class="n">m_uniq</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_req_columns</span> <span class="o">=</span> <span class="n">metadata_columns</span></div>

<div class="viewcode-block" id="FeatureSet.get_pca_df"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet.get_pca_df">[docs]</a>    <span class="k">def</span> <span class="nf">get_pca_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a copy of the PCA reduction as a DataFrame.  Will be None if the reduction has not been done.</span>

<span class="sd">        Each example is on it&#39;s own row with it&#39;s primary components.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A copy of the PCA results along with the example&#39;s metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="FeatureSet.update_example_set"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet.update_example_set">[docs]</a>    <span class="k">def</span> <span class="nf">update_example_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">metadata_columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the _example_df and blanks other internal data derived from it.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df:</span>
<span class="sd">                A DataFrame containing an example per row with additional feature information.  Must be valid for this</span>
<span class="sd">                FeatureSet.</span>
<span class="sd">            metadata_columns:</span>
<span class="sd">                A new list of metadata columns for df</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metadata_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_metadata_columns</span><span class="p">(</span><span class="n">metadata_columns</span><span class="o">=</span><span class="n">metadata_columns</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">update_example_set</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FeatureSet.do_pca_reduction"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet.do_pca_reduction">[docs]</a>    <span class="k">def</span> <span class="nf">do_pca_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n_components</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Perform PCA on subset of columns of example_df and maintain example metadata in results.</span>

<span class="sd">        The results are accessible through the get_pca_df() method and the fitted model through the pca attribute.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            metadata_cols:</span>
<span class="sd">                The column names of feature_df that contain the metadata of the events (labels, etc.).  All columns not</span>
<span class="sd">                listed in event_cols are used in PCA analysis.  If None, it defaults to the values supplied at</span>
<span class="sd">                construction of FeatureSet.</span>
<span class="sd">            report:</span>
<span class="sd">                Should a report of explained variance be printed</span>
<span class="sd">            n_components:</span>
<span class="sd">                The number of principal components to calculate.</span>
<span class="sd">            **kwargs:</span>
<span class="sd">                Remaining keyword arguments will be passed to sklearn.decomposition.PCA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup data for doing PCA.  x is the feature data to be reduced</span>
        <span class="k">if</span> <span class="n">metadata_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Pandas lets you use a tuple as a key.  Need as a list.</span>
            <span class="n">metadata_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span><span class="p">)</span>

        <span class="c1"># Do the PCA dimensionality reduction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">do_pca_reduction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_example_df</span><span class="p">,</span> <span class="n">metadata_cols</span><span class="o">=</span><span class="n">metadata_cols</span><span class="p">,</span>
                                                       <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Print explained variance ratio if requested</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Explained Variance Ratio&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureSet.display_2d_scatterplot"><a class="viewcode-back" href="../../_autosummary/rfwtools.feature_set.FeatureSet.html#rfwtools.feature_set.FeatureSet.display_2d_scatterplot">[docs]</a>    <span class="k">def</span> <span class="nf">display_2d_scatterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">technique</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Display a two-dimensional scatterplot of the dimensionally reduced feature set.</span>

<span class="sd">        If the type specified has not already been generated, an exception is raised.  Note: consider passing</span>
<span class="sd">        hue=&lt;pca_df column_name&gt; and/or style=&lt;pca_df column_name&gt; to control which column colors/styles each point.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            technique: The type of dim reduction data to display.  Currently the only supported option is pca.</span>
<span class="sd">            alpha: Controls point transparency</span>
<span class="sd">            s: Controls point size</span>
<span class="sd">            title: The title of the scatterplot</span>
<span class="sd">            figsize: The two dimensions of the size of the figure.  Passed to plt.figure.</span>
<span class="sd">            query: A pd.DataFrame.query() expr argument.  Used to subset the data prior to plotting.</span>
<span class="sd">            **kwargs: All remaining parameters are passed directly to the scatterplot command</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Figure out which type of plot we&#39;re showing</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__select_technique_data</span><span class="p">(</span><span class="n">technique</span><span class="o">=</span><span class="n">technique</span><span class="p">)</span>

        <span class="c1"># Subset the data if requested</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">technique</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># Plot the figure</span>
        <span class="n">scatterplot</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__select_technique_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">technique</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience method for getting the x,y plotting columns and total dataset for a given dim reduction.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">technique</span> <span class="o">==</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Internal pca_df is None.  Must first run do_pca_reduction().&quot;</span><span class="p">)</span>

            <span class="c1"># Filter the DataFrame if requested</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pca_df</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;pc1&#39;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;pc2&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only technique=&#39;pca&#39; is supported&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check equality between FeatureSets based on feature_df and metadata_columns.&quot;&quot;&quot;</span>

        <span class="c1"># Short circuit checks</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">FeatureSet</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Check the metadata columns</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_columns</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">metadata_columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check the feature DataFrame</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_example_df</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_example_df</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Jefferson Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>